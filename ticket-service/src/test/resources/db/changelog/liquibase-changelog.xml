<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">
    <changeSet author="Sergei (generated)" id="1547304762872-1">
        <createTable tableName="aircraft">
            <column name="aircraft_id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="aircraft_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="weight" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="max_passengers" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="model" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <loadUpdateData file="/csv/aircraft.csv"
                        primaryKey="pk_id"
                        quotchar="A String"
                        schemaName="public"
                        separator="A String"
                        tableName="aircraft">
        </loadUpdateData>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-2">
        <createTable tableName="aircraft_seq">
            <column name="next_val" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-3">
        <createTable tableName="customer">
            <column name="customer_id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="age" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="first_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <loadUpdateData file="/csv/customer.csv"
                        primaryKey="pk_id"
                        quotchar="A String"
                        schemaName="public"
                        separator="A String"
                        tableName="customer">
        </loadUpdateData>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-4">
        <createTable tableName="customer_seq">
            <column name="next_val" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-5">
        <createTable tableName="reservation">
            <column name="reservation_id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="reservation_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="customer_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="route_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <loadUpdateData file="/csv/reservation.csv"
                        primaryKey="pk_id"
                        quotchar="A String"
                        schemaName="public"
                        separator="A String"
                        tableName="reservation">
        </loadUpdateData>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-6">
        <createTable tableName="reservation_seq">
            <column name="next_val" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-7">
        <createTable tableName="route">
            <column name="route_id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="arrival_time" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="departure_time" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="distance" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="place" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="price" type="DECIMAL(19, 2)">
                <constraints nullable="false"/>
            </column>
            <column name="aircraft_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <loadUpdateData file="/csv/route.csv"
                        primaryKey="pk_id"
                        quotchar="A String"
                        schemaName="public"
                        separator="A String"
                        tableName="route">
        </loadUpdateData>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-8">
        <createTable tableName="route_seq">
            <column name="next_val" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-9">
        <createIndex indexName="FKcamidltflqvw3kkdlbuslr2db" tableName="reservation">
            <column name="customer_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-10">
        <createIndex indexName="FKcbe3ghgonsviponovpalraxnp" tableName="reservation">
            <column name="route_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-11">
        <createIndex indexName="FKhmxsignt10g676bwrwd04kyb0" tableName="route">
            <column name="aircraft_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-12">
        <addForeignKeyConstraint baseColumnNames="customer_id" baseTableName="reservation"
                                 constraintName="FKcamidltflqvw3kkdlbuslr2db" deferrable="false"
                                 initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="customer_id" referencedTableName="customer" validate="true"/>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-13">
        <addForeignKeyConstraint baseColumnNames="route_id" baseTableName="reservation"
                                 constraintName="FKcbe3ghgonsviponovpalraxnp" deferrable="false"
                                 initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="route_id" referencedTableName="route" validate="true"/>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-14">
        <addForeignKeyConstraint baseColumnNames="aircraft_id" baseTableName="route"
                                 constraintName="FKhmxsignt10g676bwrwd04kyb0" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="aircraft_id" referencedTableName="aircraft" validate="true"/>
    </changeSet>
    <changeSet author="Sergei (generated)" id="1547304762872-15">
        <createView replaceIfExists="true"
                    schemaName="public"
                    viewName="ticket_view">
            SELECT
            c.customer_id AS customer_id,
            c.first_name AS first_name,
            c.last_name AS last_name,
            r.route_id AS route_id,
            rt.place AS place,
            rt.distance AS distance,
            rt.price AS price,
            a.aircraft_name AS aircraft_name
            FROM
            (((customer c
            JOIN reservation r)
            JOIN route rt)
            JOIN aircraft a)
            WHERE
            ((c.customer_id = r.customer_id)
            AND (r.route_id = rt.route_id)
            AND (rt.aircraft_id = a.aircraft_id))
        </createView>
    </changeSet>
</databaseChangeLog>
